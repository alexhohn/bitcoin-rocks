worker_processes 1;
daemon off;

events {
    worker_connections 1024;
}

http {
    default_type text/html;
    sendfile on;
    keepalive_timeout 65;

    server {
        listen 8080;
        server_name localhost;

        root /app;
        index index.html;

        # Clean URLs: /page â†’ /page.html
        location / {
            try_files $uri $uri.html $uri/ =404;
        }

        # CORS headers for .well-known files
        location ~ ^/\.well-known/ {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Headers "*";
            add_header Access-Control-Allow-Methods "GET, OPTIONS";
        }

        # Redirects from your original .htaccess
        rewrite ^/orange-pill-pack$ /stickers permanent;
        rewrite ^/sticker$ /stickers permanent;
        rewrite ^/bitcoin-stickers$ /stickers permanent;
        rewrite ^/opp$ /stickers permanent;
        rewrite ^/gold$ /bitcoin-vs-gold permanent;
        rewrite (?i)^/cbdc$ /bitcoin-vs-cbdc permanent;
        rewrite (?i)^/inflation$ /inflation permanent;
        rewrite (?i)^/bank-run$ /bank-runs permanent;
        rewrite (?i)^/bankrun$ /bank-runs permanent;
        rewrite (?i)^/bankruns$ /bank-runs permanent;
        rewrite ^/wallet$ /wallets permanent;
        rewrite ^/postcard$ /postcards permanent;
        rewrite ^/guide$ /business/guide permanent;
        rewrite ^/guides$ /business/guide permanent;
        rewrite ^/business/guides$ /business/guide permanent;
        rewrite ^/kit$ /business/kit permanent;
        rewrite ^/business-kit$ /business/kit permanent;
        rewrite ^/businesskit$ /business/kit permanent;
        rewrite (?i)^/lightning$ /lightning permanent;
        rewrite ^/save$ /inflation?sign=got-inflation permanent;

        # Fallback 404 page
        error_page 404 /404.html;

        # Security headers
        add_header X-Frame-Options "SAMEORIGIN";
        add_header X-Content-Type-Options "nosniff";
    }
}
